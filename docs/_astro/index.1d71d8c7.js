import{B as ke,D as Re,A as De,E as Ie,F as bt,G as Oe,H as Ct,I as xt,J as Ne,K as U,L as Et,M as Ft}from"./settings.7cf660d4.js";import"./index.528e429e.js";function St(a,c){function r(){this.constructor=a}r.prototype=c.prototype,a.prototype=new r}function N(a,c,r,h){var d=Error.call(this,a);return Object.setPrototypeOf&&Object.setPrototypeOf(d,N.prototype),d.expected=c,d.found=r,d.location=h,d.name="SyntaxError",d}St(N,Error);function K(a,c,r){return r=r||" ",a.length>c?a:(c-=a.length,r+=r.repeat(c),a+r.slice(0,c))}N.prototype.format=function(a){var c="Error: "+this.message;if(this.location){var r=null,h;for(h=0;h<a.length;h++)if(a[h].source===this.location.source){r=a[h].text.split(/\r\n|\n|\r/g);break}var d=this.location.start,A=this.location.source&&typeof this.location.source.offset=="function"?this.location.source.offset(d):d,w=this.location.source+":"+A.line+":"+A.column;if(r){var m=this.location.end,y=K("",A.line.toString().length," "),p=r[d.line-1],$=d.line===m.line?m.column:p.length+1,b=$-d.column||1;c+=`
 --> `+w+`
`+y+` |
`+A.line+" | "+p+`
`+y+" | "+K("",d.column-1," ")+K("",b,"^")}else c+=`
 at `+w}return c};N.buildMessage=function(a,c){var r={literal:function(p){return'"'+d(p.text)+'"'},class:function(p){var $=p.parts.map(function(b){return Array.isArray(b)?A(b[0])+"-"+A(b[1]):A(b)});return"["+(p.inverted?"^":"")+$.join("")+"]"},any:function(){return"any character"},end:function(){return"end of input"},other:function(p){return p.description}};function h(p){return p.charCodeAt(0).toString(16).toUpperCase()}function d(p){return p.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function($){return"\\x0"+h($)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function($){return"\\x"+h($)})}function A(p){return p.replace(/\\/g,"\\\\").replace(/\]/g,"\\]").replace(/\^/g,"\\^").replace(/-/g,"\\-").replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function($){return"\\x0"+h($)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function($){return"\\x"+h($)})}function w(p){return r[p.type](p)}function m(p){var $=p.map(w),b,j;if($.sort(),$.length>0){for(b=1,j=1;b<$.length;b++)$[b-1]!==$[b]&&($[j]=$[b],j++);$.length=j}switch($.length){case 1:return $[0];case 2:return $[0]+" or "+$[1];default:return $.slice(0,-1).join(", ")+", or "+$[$.length-1]}}function y(p){return p?'"'+d(p)+'"':"end of input"}return"Expected "+m(a)+" but "+y(c)+" found."};function qe(a,c){c=c!==void 0?c:{};var r={},h=c.grammarSource,d={start:be},A=be,w=".",m="-",y="+",p="0",$=",",b="|",j='"',Te="'",ze="#",Me="^",Ge="_",X="[",Q="]",We="{",Ze="}",He="%",Je="<",Ke=">",Ue="@",Xe="!",Qe="(",Ve=")",Ye="/",er="*",rr="?",sr=":",V="struct",Y="target",ee="euclid",re="slow",se="rotL",te="rotR",ne="fast",ae="scale",ie="//",fe="cat",tr="$",oe="setcps",le="setbpm",ce="hush",nr=/^[1-9]/,ar=/^[eE]/,ir=/^[0-9]/,ue=/^[ \n\r\t]/,fr=/^[0-9a-zA-Z~]/,pe=/^[^\n]/,or=ye("number"),ge=v(".",!1),lr=P([["1","9"]],!1,!1),cr=P(["e","E"],!1,!1),ve=v("-",!1),ur=v("+",!1),pr=v("0",!1),gr=P([["0","9"]],!1,!1),vr=ye("whitespace"),$e=P([" ",`
`,"\r","	"],!1,!1),$r=v(",",!1),hr=v("|",!1),mr=v('"',!1),_r=v("'",!1),dr=P([["0","9"],["a","z"],["A","Z"],"~"],!1,!1),wr=v("#",!1),yr=v("^",!1),Ar=v("_",!1),he=v("[",!1),me=v("]",!1),br=v("{",!1),Cr=v("}",!1),xr=v("%",!1),Er=v("<",!1),Fr=v(">",!1),Sr=v("@",!1),jr=v("!",!1),Pr=v("(",!1),kr=v(")",!1),Rr=v("/",!1),Dr=v("*",!1),Ir=v("?",!1),Or=v(":",!1),Nr=v("struct",!1),qr=v("target",!1),Br=v("euclid",!1),Lr=v("slow",!1),Tr=v("rotL",!1),zr=v("rotR",!1),Mr=v("fast",!1),Gr=v("scale",!1),Wr=v("//",!1),_e=P([`
`],!0,!1),Zr=v("cat",!1),Hr=v("$",!1),Jr=v("setcps",!1),Kr=v("setbpm",!1),Ur=v("hush",!1),Xr=function(){return parseFloat(Rs())},Qr=function(e){return new wt(e.join(""))},Vr=function(e){return e},Yr=function(e,s){return e.arguments_.stepsPerCycle=s,e},es=function(e){return e},rs=function(e){return e.arguments_.alignment="slowcat",e},ss=function(e){return s=>s.options_.weight=e},ts=function(e){return s=>s.options_.reps=e},ns=function(e,s,n){return i=>i.options_.ops.push({type_:"bjorklund",arguments_:{pulse:e,step:s,rotation:n}})},as=function(e){return s=>s.options_.ops.push({type_:"stretch",arguments_:{amount:e,type:"slow"}})},is=function(e){return s=>s.options_.ops.push({type_:"stretch",arguments_:{amount:e,type:"fast"}})},fs=function(e){return s=>s.options_.ops.push({type_:"degradeBy",arguments_:{amount:e,seed:Pe++}})},os=function(e){return s=>s.options_.ops.push({type_:"tail",arguments_:{element:e}})},ls=function(e,s){const n=new At(e,{ops:[],weight:1,reps:1});for(const i of s)i(n);return n},cs=function(e){return new G(e,"fastcat")},us=function(e){return{alignment:"stack",list:e}},ps=function(e){return{alignment:"rand",list:e,seed:Pe++}},gs=function(e,s){return s&&s.list.length>0?new G([e,...s.list],s.alignment,s.seed):e},vs=function(e,s){return new G(s?[e,...s.list]:[e],"polymeter")},$s=function(e){return e},hs=function(e){return{name:"struct",args:{mini:e}}},ms=function(e){return{name:"target",args:{name:e}}},_s=function(e,s,n){return{name:"bjorklund",args:{pulse:e,step:parseInt(s)}}},ds=function(e){return{name:"stretch",args:{amount:e}}},ws=function(e){return{name:"shift",args:{amount:"-"+e}}},ys=function(e){return{name:"shift",args:{amount:e}}},As=function(e){return{name:"stretch",args:{amount:"1/"+e}}},bs=function(e){return{name:"scale",args:{scale:e.join("")}}},de=function(e,s){return s},Cs=function(e,s){return s.unshift(e),new G(s,"slowcat")},xs=function(e){return e},Es=function(e,s){return new yt(e.name,e.args,s)},Fs=function(e){return e},Ss=function(e){return e},js=function(e){return new J("setcps",{value:e})},Ps=function(e){return new J("setcps",{value:e/120/2})},ks=function(){return new J("hush")},t=0,g=0,L=[{line:1,column:1}],E=0,W=[],f=0,T;if("startRule"in c){if(!(c.startRule in d))throw new Error(`Can't start parsing from rule "`+c.startRule+'".');A=d[c.startRule]}function Rs(){return a.substring(g,t)}function we(){return Z(g,t)}function v(e,s){return{type:"literal",text:e,ignoreCase:s}}function P(e,s,n){return{type:"class",parts:e,inverted:s,ignoreCase:n}}function Ds(){return{type:"end"}}function ye(e){return{type:"other",description:e}}function Ae(e){var s=L[e],n;if(s)return s;for(n=e-1;!L[n];)n--;for(s=L[n],s={line:s.line,column:s.column};n<e;)a.charCodeAt(n)===10?(s.line++,s.column=1):s.column++,n++;return L[e]=s,s}function Z(e,s,n){var i=Ae(e),l=Ae(s),_={source:h,start:{offset:e,line:i.line,column:i.column},end:{offset:s,line:l.line,column:l.column}};return n&&h&&typeof h.offset=="function"&&(_.start=h.offset(_.start),_.end=h.offset(_.end)),_}function o(e){t<E||(t>E&&(E=t,W=[]),W.push(e))}function Is(e,s,n){return new N(N.buildMessage(e,s),e,s,n)}function be(){var e;return e=dt(),e}function F(){var e,s;return f++,e=t,Ce(),s=z(),s!==r?(Ls(),Bs(),g=e,e=Xr()):(t=e,e=r),f--,e===r&&f===0&&o(or),e}function Os(){var e;return a.charCodeAt(t)===46?(e=w,t++):(e=r,f===0&&o(ge)),e}function Ns(){var e;return nr.test(a.charAt(t))?(e=a.charAt(t),t++):(e=r,f===0&&o(lr)),e}function qs(){var e;return ar.test(a.charAt(t))?(e=a.charAt(t),t++):(e=r,f===0&&o(cr)),e}function Bs(){var e,s,n,i,l;if(e=t,s=qs(),s!==r){if(n=Ce(),n===r&&(n=Ts()),n===r&&(n=null),i=[],l=k(),l!==r)for(;l!==r;)i.push(l),l=k();else i=r;i!==r?(s=[s,n,i],e=s):(t=e,e=r)}else t=e,e=r;return e}function Ls(){var e,s,n,i;if(e=t,s=Os(),s!==r){if(n=[],i=k(),i!==r)for(;i!==r;)n.push(i),i=k();else n=r;n!==r?(s=[s,n],e=s):(t=e,e=r)}else t=e,e=r;return e}function z(){var e,s,n,i;if(e=zs(),e===r)if(e=t,s=Ns(),s!==r){for(n=[],i=k();i!==r;)n.push(i),i=k();s=[s,n],e=s}else t=e,e=r;return e}function Ce(){var e;return a.charCodeAt(t)===45?(e=m,t++):(e=r,f===0&&o(ve)),e}function Ts(){var e;return a.charCodeAt(t)===43?(e=y,t++):(e=r,f===0&&o(ur)),e}function zs(){var e;return a.charCodeAt(t)===48?(e=p,t++):(e=r,f===0&&o(pr)),e}function k(){var e;return ir.test(a.charAt(t))?(e=a.charAt(t),t++):(e=r,f===0&&o(gr)),e}function u(){var e,s;for(f++,e=[],ue.test(a.charAt(t))?(s=a.charAt(t),t++):(s=r,f===0&&o($e));s!==r;)e.push(s),ue.test(a.charAt(t))?(s=a.charAt(t),t++):(s=r,f===0&&o($e));return f--,s=r,f===0&&o(vr),e}function R(){var e,s,n,i;return e=t,s=u(),a.charCodeAt(t)===44?(n=$,t++):(n=r,f===0&&o($r)),n!==r?(i=u(),s=[s,n,i],e=s):(t=e,e=r),e}function xe(){var e,s,n,i;return e=t,s=u(),a.charCodeAt(t)===124?(n=b,t++):(n=r,f===0&&o(hr)),n!==r?(i=u(),s=[s,n,i],e=s):(t=e,e=r),e}function D(){var e;return a.charCodeAt(t)===34?(e=j,t++):(e=r,f===0&&o(mr)),e===r&&(a.charCodeAt(t)===39?(e=Te,t++):(e=r,f===0&&o(_r))),e}function M(){var e;return fr.test(a.charAt(t))?(e=a.charAt(t),t++):(e=r,f===0&&o(dr)),e===r&&(a.charCodeAt(t)===45?(e=m,t++):(e=r,f===0&&o(ve)),e===r&&(a.charCodeAt(t)===35?(e=ze,t++):(e=r,f===0&&o(wr)),e===r&&(a.charCodeAt(t)===46?(e=w,t++):(e=r,f===0&&o(ge)),e===r&&(a.charCodeAt(t)===94?(e=Me,t++):(e=r,f===0&&o(yr)),e===r&&(a.charCodeAt(t)===95?(e=Ge,t++):(e=r,f===0&&o(Ar))))))),e}function Ee(){var e,s,n;if(e=t,u(),s=[],n=M(),n!==r)for(;n!==r;)s.push(n),n=M();else s=r;return s!==r?(n=u(),g=e,e=Qr(s)):(t=e,e=r),e}function Ms(){var e,s,n,i;return e=t,u(),a.charCodeAt(t)===91?(s=X,t++):(s=r,f===0&&o(he)),s!==r?(u(),n=je(),n!==r?(u(),a.charCodeAt(t)===93?(i=Q,t++):(i=r,f===0&&o(me)),i!==r?(u(),g=e,e=Vr(n)):(t=e,e=r)):(t=e,e=r)):(t=e,e=r),e}function Gs(){var e,s,n,i,l;return e=t,u(),a.charCodeAt(t)===123?(s=We,t++):(s=r,f===0&&o(br)),s!==r?(u(),n=et(),n!==r?(u(),a.charCodeAt(t)===125?(i=Ze,t++):(i=r,f===0&&o(Cr)),i!==r?(l=Ws(),l===r&&(l=null),u(),g=e,e=Yr(n,l)):(t=e,e=r)):(t=e,e=r)):(t=e,e=r),e}function Ws(){var e,s,n;return e=t,a.charCodeAt(t)===37?(s=He,t++):(s=r,f===0&&o(xr)),s!==r?(n=q(),n!==r?(g=e,e=es(n)):(t=e,e=r)):(t=e,e=r),e}function Zs(){var e,s,n,i;return e=t,u(),a.charCodeAt(t)===60?(s=Je,t++):(s=r,f===0&&o(Er)),s!==r?(u(),n=S(),n!==r?(u(),a.charCodeAt(t)===62?(i=Ke,t++):(i=r,f===0&&o(Fr)),i!==r?(u(),g=e,e=rs(n)):(t=e,e=r)):(t=e,e=r)):(t=e,e=r),e}function q(){var e;return e=Ee(),e===r&&(e=Ms(),e===r&&(e=Gs(),e===r&&(e=Zs()))),e}function Fe(){var e;return e=Hs(),e===r&&(e=Ks(),e===r&&(e=Us(),e===r&&(e=Xs(),e===r&&(e=Js(),e===r&&(e=Qs(),e===r&&(e=Vs())))))),e}function Hs(){var e,s,n;return e=t,a.charCodeAt(t)===64?(s=Ue,t++):(s=r,f===0&&o(Sr)),s!==r?(n=F(),n!==r?(g=e,e=ss(n)):(t=e,e=r)):(t=e,e=r),e}function Js(){var e,s,n;return e=t,a.charCodeAt(t)===33?(s=Xe,t++):(s=r,f===0&&o(jr)),s!==r?(n=F(),n!==r?(g=e,e=ts(n)):(t=e,e=r)):(t=e,e=r),e}function Ks(){var e,s,n,i,l,_,x;return e=t,a.charCodeAt(t)===40?(s=Qe,t++):(s=r,f===0&&o(Pr)),s!==r?(u(),n=B(),n!==r?(u(),i=R(),i!==r?(u(),l=B(),l!==r?(u(),R(),u(),_=B(),_===r&&(_=null),u(),a.charCodeAt(t)===41?(x=Ve,t++):(x=r,f===0&&o(kr)),x!==r?(g=e,e=ns(n,l,_)):(t=e,e=r)):(t=e,e=r)):(t=e,e=r)):(t=e,e=r)):(t=e,e=r),e}function Us(){var e,s,n;return e=t,a.charCodeAt(t)===47?(s=Ye,t++):(s=r,f===0&&o(Rr)),s!==r?(n=q(),n!==r?(g=e,e=as(n)):(t=e,e=r)):(t=e,e=r),e}function Xs(){var e,s,n;return e=t,a.charCodeAt(t)===42?(s=er,t++):(s=r,f===0&&o(Dr)),s!==r?(n=q(),n!==r?(g=e,e=is(n)):(t=e,e=r)):(t=e,e=r),e}function Qs(){var e,s,n;return e=t,a.charCodeAt(t)===63?(s=rr,t++):(s=r,f===0&&o(Ir)),s!==r?(n=F(),n===r&&(n=null),g=e,e=fs(n)):(t=e,e=r),e}function Vs(){var e,s,n;return e=t,a.charCodeAt(t)===58?(s=sr,t++):(s=r,f===0&&o(Or)),s!==r?(n=q(),n!==r?(g=e,e=os(n)):(t=e,e=r)):(t=e,e=r),e}function B(){var e,s,n,i;if(e=t,s=q(),s!==r){for(n=[],i=Fe();i!==r;)n.push(i),i=Fe();g=e,e=ls(s,n)}else t=e,e=r;return e}function S(){var e,s,n;if(e=t,s=[],n=B(),n!==r)for(;n!==r;)s.push(n),n=B();else s=r;return s!==r&&(g=e,s=cs(s)),e=s,e}function Se(){var e,s,n,i,l;if(e=t,s=[],n=t,i=R(),i!==r?(l=S(),l!==r?n=l:(t=n,n=r)):(t=n,n=r),n!==r)for(;n!==r;)s.push(n),n=t,i=R(),i!==r?(l=S(),l!==r?n=l:(t=n,n=r)):(t=n,n=r);else s=r;return s!==r&&(g=e,s=us(s)),e=s,e}function Ys(){var e,s,n,i,l;if(e=t,s=[],n=t,i=xe(),i!==r?(l=S(),l!==r?n=l:(t=n,n=r)):(t=n,n=r),n!==r)for(;n!==r;)s.push(n),n=t,i=xe(),i!==r?(l=S(),l!==r?n=l:(t=n,n=r)):(t=n,n=r);else s=r;return s!==r&&(g=e,s=ps(s)),e=s,e}function je(){var e,s,n;return e=t,s=S(),s!==r?(n=Se(),n===r&&(n=Ys()),n===r&&(n=null),g=e,e=gs(s,n)):(t=e,e=r),e}function et(){var e,s,n;return e=t,s=S(),s!==r?(n=Se(),n===r&&(n=null),g=e,e=vs(s,n)):(t=e,e=r),e}function rt(){var e,s,n,i;return e=t,u(),s=D(),s!==r?(u(),n=je(),n!==r?(u(),i=D(),i!==r?(g=e,e=$s(n)):(t=e,e=r)):(t=e,e=r)):(t=e,e=r),e}function st(){var e;return e=ct(),e===r&&(e=it(),e===r&&(e=lt(),e===r&&(e=nt(),e===r&&(e=at(),e===r&&(e=tt(),e===r&&(e=ot(),e===r&&(e=ft()))))))),e}function tt(){var e,s,n;return e=t,a.substr(t,6)===V?(s=V,t+=6):(s=r,f===0&&o(Nr)),s!==r?(u(),n=I(),n!==r?(g=e,e=hs(n)):(t=e,e=r)):(t=e,e=r),e}function nt(){var e,s,n,i,l;return e=t,a.substr(t,6)===Y?(s=Y,t+=6):(s=r,f===0&&o(qr)),s!==r?(u(),n=D(),n!==r?(i=Ee(),i!==r?(l=D(),l!==r?(g=e,e=ms(i)):(t=e,e=r)):(t=e,e=r)):(t=e,e=r)):(t=e,e=r),e}function at(){var e,s,n,i;return e=t,a.substr(t,6)===ee?(s=ee,t+=6):(s=r,f===0&&o(Br)),s!==r?(u(),n=z(),n!==r?(u(),i=z(),i!==r?(u(),z(),g=e,e=_s(n,i)):(t=e,e=r)):(t=e,e=r)):(t=e,e=r),e}function it(){var e,s,n;return e=t,a.substr(t,4)===re?(s=re,t+=4):(s=r,f===0&&o(Lr)),s!==r?(u(),n=F(),n!==r?(g=e,e=ds(n)):(t=e,e=r)):(t=e,e=r),e}function ft(){var e,s,n;return e=t,a.substr(t,4)===se?(s=se,t+=4):(s=r,f===0&&o(Tr)),s!==r?(u(),n=F(),n!==r?(g=e,e=ws(n)):(t=e,e=r)):(t=e,e=r),e}function ot(){var e,s,n;return e=t,a.substr(t,4)===te?(s=te,t+=4):(s=r,f===0&&o(zr)),s!==r?(u(),n=F(),n!==r?(g=e,e=ys(n)):(t=e,e=r)):(t=e,e=r),e}function lt(){var e,s,n;return e=t,a.substr(t,4)===ne?(s=ne,t+=4):(s=r,f===0&&o(Mr)),s!==r?(u(),n=F(),n!==r?(g=e,e=As(n)):(t=e,e=r)):(t=e,e=r),e}function ct(){var e,s,n,i,l;if(e=t,a.substr(t,5)===ae?(s=ae,t+=5):(s=r,f===0&&o(Gr)),s!==r)if(u(),n=D(),n!==r){if(i=[],l=M(),l!==r)for(;l!==r;)i.push(l),l=M();else i=r;i!==r?(l=D(),l!==r?(g=e,e=bs(i)):(t=e,e=r)):(t=e,e=r)}else t=e,e=r;else t=e,e=r;return e}function H(){var e,s,n,i;if(e=t,a.substr(t,2)===ie?(s=ie,t+=2):(s=r,f===0&&o(Wr)),s!==r){for(n=[],pe.test(a.charAt(t))?(i=a.charAt(t),t++):(i=r,f===0&&o(_e));i!==r;)n.push(i),pe.test(a.charAt(t))?(i=a.charAt(t),t++):(i=r,f===0&&o(_e));s=[s,n],e=s}else t=e,e=r;return e}function ut(){var e,s,n,i,l,_,x,O;if(e=t,a.substr(t,3)===fe?(s=fe,t+=3):(s=r,f===0&&o(Zr)),s!==r)if(u(),a.charCodeAt(t)===91?(n=X,t++):(n=r,f===0&&o(he)),n!==r)if(u(),i=I(),i!==r){for(l=[],_=t,x=R(),x!==r?(O=I(),O!==r?(g=_,_=de(i,O)):(t=_,_=r)):(t=_,_=r);_!==r;)l.push(_),_=t,x=R(),x!==r?(O=I(),O!==r?(g=_,_=de(i,O)):(t=_,_=r)):(t=_,_=r);_=u(),a.charCodeAt(t)===93?(x=Q,t++):(x=r,f===0&&o(me)),x!==r?(g=e,e=Cs(i,l)):(t=e,e=r)}else t=e,e=r;else t=e,e=r;else t=e,e=r;return e}function pt(){var e;return e=ut(),e===r&&(e=rt()),e}function I(){var e,s,n,i,l;if(e=t,s=pt(),s!==r){for(u(),n=[],i=H();i!==r;)n.push(i),i=H();g=e,e=xs(s)}else t=e,e=r;return e===r&&(e=t,s=st(),s!==r?(u(),a.charCodeAt(t)===36?(n=tr,t++):(n=r,f===0&&o(Hr)),n!==r?(i=u(),l=I(),l!==r?(g=e,e=Es(s,l)):(t=e,e=r)):(t=e,e=r)):(t=e,e=r)),e}function gt(){var e,s;return e=t,s=I(),s!==r&&(g=e,s=Fs(s)),e=s,e===r&&(e=H()),e}function vt(){var e;return e=gt(),e}function $t(){var e,s;return e=t,u(),s=ht(),s===r&&(s=mt(),s===r&&(s=_t())),s!==r?(u(),g=e,e=Ss(s)):(t=e,e=r),e}function ht(){var e,s,n;return e=t,a.substr(t,6)===oe?(s=oe,t+=6):(s=r,f===0&&o(Jr)),s!==r?(u(),n=F(),n!==r?(g=e,e=js(n)):(t=e,e=r)):(t=e,e=r),e}function mt(){var e,s,n;return e=t,a.substr(t,6)===le?(s=le,t+=6):(s=r,f===0&&o(Kr)),s!==r?(u(),n=F(),n!==r?(g=e,e=Ps(n)):(t=e,e=r)):(t=e,e=r),e}function _t(){var e,s;return e=t,a.substr(t,4)===ce?(s=ce,t+=4):(s=r,f===0&&o(Ur)),s!==r&&(g=e,s=ks()),e=s,e}function dt(){var e;return e=vt(),e===r&&(e=$t()),e}var wt=function(e){this.type_="atom",this.source_=e,this.location_=we()},G=function(e,s,n){this.type_="pattern",this.arguments_={alignment:s},n!==void 0&&(this.arguments_.seed=n),this.source_=e},yt=function(e,s,n){this.type_=e,this.arguments_=s,this.source_=n},At=function(e,s){this.type_="element",this.source_=e,this.options_=s,this.location_=we()},J=function(e,s){this.type_="command",this.name_=e,this.options_=s},Pe=0;if(T=A(),T!==r&&t===a.length)return T;throw T!==r&&t<a.length&&o(Ds()),Is(W,E<a.length?a.charAt(E):null,E<a.length?Z(E,E+1):Z(E,E))}const Be=3e-4,jt=(a,c)=>(r,h)=>{const w=a.source_[h].options_?.ops;if(w)for(const m of w)switch(m.type_){case"stretch":{const y=["fast","slow"],{type:p,amount:$}=m.arguments_;if(!y.includes(p))throw new Error(`mini: stretch: type must be one of ${y.join("|")} but got ${p}`);r=U(r)[p](C($,c));break}case"bjorklund":{m.arguments_.rotation?r=r.euclidRot(C(m.arguments_.pulse,c),C(m.arguments_.step,c),C(m.arguments_.rotation,c)):r=r.euclid(C(m.arguments_.pulse,c),C(m.arguments_.step,c));break}case"degradeBy":{r=U(r)._degradeByWith(Oe.early(Be*m.arguments_.seed),m.arguments_.amount??.5);break}case"tail":{const y=C(m.arguments_.element,c);r=r.fmap(p=>$=>Array.isArray(p)?[...p,$]:[p,$]).appLeft(y);break}default:console.warn(`operator "${m.type_}" not implemented`)}return r};function Pt(a){a.source_=Et(a.source_.map(c=>{const{reps:r}=c.options_||{};return r?(delete c.options_.reps,Array(r).fill(c)):[c]}))}function C(a,c){switch(a.type_){case"pattern":{Pt(a);const r=a.source_.map(w=>C(w,c)).map(jt(a,c)),h=a.arguments_.alignment;if(h==="stack")return De(...r);if(h==="polymeter"){const w=a.arguments_.stepsPerCycle?C(a.arguments_.stepsPerCycle,c).fmap(y=>Ie(y)):Re(Ie(r.length>0?r[0].__weight:1)),m=r.map(y=>y.fast(w.fmap(p=>p.div(y.__weight||1))));return De(...m)}if(h==="rand")return bt(Oe.early(Be*a.arguments_.seed).segment(1),r);const d=a.source_.some(w=>!!w.options_?.weight);if(!d&&h==="slowcat")return Ct(...r);if(d){const w=a.source_.reduce((y,p)=>y+(p.options_?.weight||1),0),m=xt(...a.source_.map((y,p)=>[y.options_?.weight||1,r[p]]));return h==="slowcat"?m._slow(w):(m.__weight=w,m)}const A=Ne(...r);return A.__weight=r.length,A}case"element":return C(a.source_,c);case"atom":{if(a.source_==="~")return ke;if(!a.location_)return console.warn("no location for",a),a.source_;const{start:r,end:h}=a.location_,d=isNaN(Number(a.source_))?a.source_:Number(a.source_),A=c?.split("").slice(r.offset,h.offset).join(""),[w=0,m=0]=A?A.split(a.source_).map(y=>y.split("").filter(p=>p===" ").length):[];return Re(d).withLocation([r.line,r.column+w,r.offset+w],[r.line,h.column-m,h.offset-m])}case"stretch":return C(a.source_,c).slow(C(a.arguments_.amount,c));default:return console.warn(`node type "${a.type_}" not implemented -> returning silence`),ke}}const Le=(...a)=>{const c=a.map(r=>{const h=`"${r}"`,d=qe(h);return C(d,h)});return Ne(...c)},Dt=a=>{const c=qe(a);return C(c,a)};function It(a){return typeof a=="string"?Le(a):U(a)}function Ot(){Ft(Le)}export{N as SyntaxError,Dt as h,Le as mini,Ot as miniAllStrings,It as minify,qe as parse,C as patternifyAST};
