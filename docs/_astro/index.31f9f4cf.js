import{a as G,d as Q,b as U,f as X,c as z,C as Y,u as Z}from"./useKeydown.b56e09aa.js";import{e as me}from"./useKeydown.b56e09aa.js";import{w as _,g as $}from"./prebake.df75c99c.js";import{l as L}from"./settings.7cf660d4.js";import{T as pe}from"./settings.7cf660d4.js";import{r as l}from"./index.528e429e.js";import{j as t}from"./jsx-runtime.0c15e696.js";import"./client.bf050b43.js";import"./doc.d4351830.js";const ee=(n,{root:d,rootMargin:f,threshold:o}={},r=[])=>{const s=l.useRef(null),i=l.useRef(null);return l.useCallback(u=>{s.current&&i.current&&(i.current.unobserve(s.current),i.current.disconnect(),i.current=null),u&&(i.current=new IntersectionObserver(n,{root:d,rootMargin:f,threshold:o}),i.current.observe(u),s.current=u)},[s,d,f,JSON.stringify(o),...r])},te=({root:n,rootMargin:d,threshold:f,unobserveOnEnter:o,target:r,onEnter:s,onLeave:i,defaultInView:g}={},u=[])=>{const[h,b]=l.useState({inView:g||!1,entry:null,observer:null}),w=l.useCallback(([a],c)=>{const m=c.thresholds.some(j=>a.intersectionRatio>=j)&&a.isIntersecting;b({inView:m,entry:a,observer:c}),m&&o&&(c.unobserve(a.target),c.disconnect()),m?s?.(a,c):i?.(a,c)},[s,i,o]),v=ee(w,{root:n,rootMargin:d,threshold:f},[o,...u]);return l.useEffect(()=>{r?.current&&v(r.current)},[r,v]),[v,h.inView,h.entry,h.observer]};function I({type:n}){return t.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",viewBox:"0 0 20 20",fill:"currentColor",children:{refresh:t.jsx("path",{fillRule:"evenodd",d:"M4 2a1 1 0 011 1v2.101a7.002 7.002 0 0111.601 2.566 1 1 0 11-1.885.666A5.002 5.002 0 005.999 7H9a1 1 0 010 2H4a1 1 0 01-1-1V3a1 1 0 011-1zm.008 9.057a1 1 0 011.276.61A5.002 5.002 0 0014.001 13H11a1 1 0 110-2h5a1 1 0 011 1v5a1 1 0 11-2 0v-2.101a7.002 7.002 0 01-11.601-2.566 1 1 0 01.61-1.276z",clipRule:"evenodd"}),play:t.jsx("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zM9.555 7.168A1 1 0 008 8v4a1 1 0 001.555.832l3-2a1 1 0 000-1.664l-3-2z",clipRule:"evenodd"}),pause:t.jsx("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zM7 8a1 1 0 012 0v4a1 1 0 11-2 0V8zm5-1a1 1 0 00-1 1v4a1 1 0 102 0V8a1 1 0 00-1-1z",clipRule:"evenodd"}),stop:t.jsx("path",{fillRule:"evenodd",d:"M2 10a8 8 0 1116 0 8 8 0 01-16 0zm5-2.25A.75.75 0 017.75 7h4.5a.75.75 0 01.75.75v4.5a.75.75 0 01-.75.75h-4.5a.75.75 0 01-.75-.75v-4.5z",clipRule:"evenodd"})}[n]})}const se=()=>$().currentTime;function ge({tune:n,hideOutsideView:d=!1,enableKeyboard:f,onTrigger:o,drawTime:r,punchcard:s,punchcardLabels:i,onPaint:g,canvasHeight:u=200,fontSize:h=18,fontFamily:b,hideHeader:w=!1,theme:v,keybindings:a,isLineNumbersDisplayed:c}){r=r||(s?[0,4]:void 0);const k=!!r,m=l.useCallback(s?e=>document.querySelector("#"+e)?.getContext("2d"):null,[s]),{code:j,setCode:S,evaluate:le,activateCode:C,error:N,isDirty:T,activeCode:A,pattern:K,started:y,scheduler:P,togglePlay:D,stop:H,canvasId:O,id:W}=G({initialCode:n,defaultOutput:_,editPattern:(e,p)=>(o&&(e=e.onTrigger(o,!1)),g?e=e.onPaint(g):s&&(e=e.punchcard({labels:i})),e),getTime:se,evalOnMount:k,drawContext:m,drawTime:r}),[x,q]=l.useState(),[B,R]=te({threshold:.01}),M=l.useRef(),F=l.useMemo(()=>((R||!d)&&(M.current=!0),R||M.current),[R,d]);Q({view:x,pattern:K,active:y&&!A?.includes("strudel disable-highlighting"),getTime:()=>P.now()}),U(l.useCallback(async e=>{x?.hasFocus&&(e.ctrlKey||e.altKey)&&(e.code==="Enter"?(e.preventDefault(),X(x),await C()):(e.key==="."||e.code==="Period")&&(H(),e.preventDefault()))},[C,H,x]));const[V,J]=l.useState([]);return ie(l.useCallback(e=>{const{data:p}=e.detail;p?.hap?.context?.id===W&&J(E=>E.concat([e.detail]).slice(-8))},[])),t.jsxs("div",{className:"overflow-hidden rounded-t-md bg-background border border-lineHighlight",ref:B,children:[!w&&t.jsx("div",{className:"flex justify-between bg-lineHighlight",children:t.jsxs("div",{className:"flex",children:[t.jsx("button",{className:z("cursor-pointer w-16 flex items-center justify-center p-1 border-r border-lineHighlight text-foreground bg-lineHighlight hover:bg-background",y?"animate-pulse":""),onClick:()=>D(),children:t.jsx(I,{type:y?"stop":"play"})}),t.jsx("button",{className:z("w-16 flex items-center justify-center p-1 text-foreground border-lineHighlight bg-lineHighlight",T?"text-foreground hover:bg-background cursor-pointer":"opacity-50 cursor-not-allowed"),onClick:()=>C(),children:t.jsx(I,{type:"refresh"})})]})}),t.jsxs("div",{className:"overflow-auto relative",children:[F&&t.jsx(Y,{value:j,onChange:S,onViewChanged:q,theme:v,fontFamily:b,fontSize:h,keybindings:a,isLineNumbersDisplayed:c}),N&&t.jsx("div",{className:"text-right p-1 text-md text-red-200",children:N.message})]}),s&&t.jsx("canvas",{id:O,className:"w-full pointer-events-none",height:u,ref:e=>{e&&e.width!==e.clientWidth&&(e.width=e.clientWidth)}}),!!V.length&&t.jsx("div",{className:"bg-gray-800 rounded-md p-2",children:V.map(({message:e},p)=>t.jsx("div",{children:e},p))})]})}function ie(n){Z(L.key,n)}export{Y as CodeMirror,ge as MiniRepl,z as cx,X as flash,pe as strudelTheme,Z as useEvent,Q as useHighlighting,U as useKeydown,me as usePostMessage,G as useStrudel};
