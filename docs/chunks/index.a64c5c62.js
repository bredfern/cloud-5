import{m as Pe,n as Se,s as Re,o as ke,q as mt,t as _t,u as dt,v as Oe,x as K,y as wt}from"./prebake.e704cc34.js";import"./index.a0884559.js";function yt(a,o){function r(){this.constructor=a}r.prototype=o.prototype,a.prototype=new r}function I(a,o,r,m){var _=Error.call(this,a);return Object.setPrototypeOf&&Object.setPrototypeOf(_,I.prototype),_.expected=o,_.found=r,_.location=m,_.name="SyntaxError",_}yt(I,Error);function J(a,o,r){return r=r||" ",a.length>o?a:(o-=a.length,r+=r.repeat(o),a+r.slice(0,o))}I.prototype.format=function(a){var o="Error: "+this.message;if(this.location){var r=null,m;for(m=0;m<a.length;m++)if(a[m].source===this.location.source){r=a[m].text.split(/\r\n|\n|\r/g);break}var _=this.location.start,A=this.location.source+":"+_.line+":"+_.column;if(r){var $=this.location.end,y=J("",_.line.toString().length," "),d=r[_.line-1],v=_.line===$.line?$.column:d.length+1,h=v-_.column||1;o+=`
 --> `+A+`
`+y+` |
`+_.line+" | "+d+`
`+y+" | "+J("",_.column-1," ")+J("",h,"^")}else o+=`
 at `+A}return o};I.buildMessage=function(a,o){var r={literal:function(v){return'"'+_(v.text)+'"'},class:function(v){var h=v.parts.map(function(C){return Array.isArray(C)?A(C[0])+"-"+A(C[1]):A(C)});return"["+(v.inverted?"^":"")+h.join("")+"]"},any:function(){return"any character"},end:function(){return"end of input"},other:function(v){return v.description}};function m(v){return v.charCodeAt(0).toString(16).toUpperCase()}function _(v){return v.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(h){return"\\x0"+m(h)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(h){return"\\x"+m(h)})}function A(v){return v.replace(/\\/g,"\\\\").replace(/\]/g,"\\]").replace(/\^/g,"\\^").replace(/-/g,"\\-").replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(h){return"\\x0"+m(h)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(h){return"\\x"+m(h)})}function $(v){return r[v.type](v)}function y(v){var h=v.map($),C,P;if(h.sort(),h.length>0){for(C=1,P=1;C<h.length;C++)h[C-1]!==h[C]&&(h[P]=h[C],P++);h.length=P}switch(h.length){case 1:return h[0];case 2:return h[0]+" or "+h[1];default:return h.slice(0,-1).join(", ")+", or "+h[h.length-1]}}function d(v){return v?'"'+_(v)+'"':"end of input"}return"Expected "+y(a)+" but "+d(o)+" found."};function De(a,o){o=o!==void 0?o:{};var r={},m=o.grammarSource,_={start:Ce},A=Ce,$=".",y="-",d="+",v="0",h=",",C="|",P='"',qe="'",Ie="#",Ne="^",Te="_",Be=":",Q="[",V="]",ze="{",Le="}",Me="%",Ze="<",Ge=">",Ue="@",Xe="!",He="(",Je=")",Ke="/",Qe="*",Ve="?",W="struct",Y="target",ee="euclid",re="slow",se="rotL",te="rotR",ne="fast",ae="scale",ie="//",fe="cat",We="$",le="setcps",oe="setbpm",ce="hush",Ye=/^[1-9]/,er=/^[eE]/,rr=/^[0-9]/,ue=/^[ \n\r\t]/,sr=/^[0-9a-zA-Z~]/,pe=/^[^\n]/,tr=ye("number"),ge=p(".",!1),nr=S([["1","9"]],!1,!1),ar=S(["e","E"],!1,!1),ve=p("-",!1),ir=p("+",!1),fr=p("0",!1),lr=S([["0","9"]],!1,!1),or=ye("whitespace"),$e=S([" ",`
`,"\r","	"],!1,!1),cr=p(",",!1),ur=p("|",!1),pr=p('"',!1),gr=p("'",!1),vr=S([["0","9"],["a","z"],["A","Z"],"~"],!1,!1),$r=p("#",!1),hr=p("^",!1),mr=p("_",!1),_r=p(":",!1),he=p("[",!1),me=p("]",!1),dr=p("{",!1),wr=p("}",!1),yr=p("%",!1),Ar=p("<",!1),Cr=p(">",!1),br=p("@",!1),xr=p("!",!1),Er=p("(",!1),Fr=p(")",!1),jr=p("/",!1),Pr=p("*",!1),Sr=p("?",!1),Rr=p("struct",!1),kr=p("target",!1),Or=p("euclid",!1),Dr=p("slow",!1),qr=p("rotL",!1),Ir=p("rotR",!1),Nr=p("fast",!1),Tr=p("scale",!1),Br=p("//",!1),_e=S([`
`],!0,!1),zr=p("cat",!1),Lr=p("$",!1),Mr=p("setcps",!1),Zr=p("setbpm",!1),Gr=p("hush",!1),Ur=function(){return parseFloat(Es())},Xr=function(e){return new vt(e.join(""))},Hr=function(e){return e},Jr=function(e,s){return e.arguments_.stepsPerCycle=s,e},Kr=function(e){return e},Qr=function(e){return e.arguments_.alignment="slowcat",e},Vr=function(e){return{weight:e}},Wr=function(e){return{replicate:e}},Yr=function(e,s,n){return{operator:{type_:"bjorklund",arguments_:{pulse:e,step:s,rotation:n}}}},es=function(e){return{operator:{type_:"stretch",arguments_:{amount:e,type:"slow"}}}},rs=function(e){return{operator:{type_:"stretch",arguments_:{amount:e,type:"fast"}}}},ss=function(e){return{operator:{type_:"degradeBy",arguments_:{amount:e}}}},ts=function(e,s){return new ht(e,s)},ns=function(e){return new Z(e,"fastcat")},as=function(e){return{alignment:"stack",list:e}},is=function(e){return{alignment:"rand",list:e}},fs=function(e,s){return s&&s.list.length>0?new Z([e,...s.list],s.alignment):e},ls=function(e,s){return new Z(s?[e,...s.list]:[e],"polymeter")},os=function(e){return e},cs=function(e){return{name:"struct",args:{mini:e}}},us=function(e){return{name:"target",args:{name:e}}},ps=function(e,s,n){return{name:"bjorklund",args:{pulse:e,step:parseInt(s)}}},gs=function(e){return{name:"stretch",args:{amount:e}}},vs=function(e){return{name:"shift",args:{amount:"-"+e}}},$s=function(e){return{name:"shift",args:{amount:e}}},hs=function(e){return{name:"stretch",args:{amount:"1/"+e}}},ms=function(e){return{name:"scale",args:{scale:e.join("")}}},de=function(e,s){return s},_s=function(e,s){return s.unshift(e),new Z(s,"slowcat")},ds=function(e){return e},ws=function(e,s){return new $t(e.name,e.args,s)},ys=function(e){return e},As=function(e){return e},Cs=function(e){return new H("setcps",{value:e})},bs=function(e){return new H("setcps",{value:e/120/2})},xs=function(){return new H("hush")},t=0,g=0,T=[{line:1,column:1}],E=0,G=[],f=0,B;if("startRule"in o){if(!(o.startRule in _))throw new Error(`Can't start parsing from rule "`+o.startRule+'".');A=_[o.startRule]}function Es(){return a.substring(g,t)}function we(){return U(g,t)}function p(e,s){return{type:"literal",text:e,ignoreCase:s}}function S(e,s,n){return{type:"class",parts:e,inverted:s,ignoreCase:n}}function Fs(){return{type:"end"}}function ye(e){return{type:"other",description:e}}function Ae(e){var s=T[e],n;if(s)return s;for(n=e-1;!T[n];)n--;for(s=T[n],s={line:s.line,column:s.column};n<e;)a.charCodeAt(n)===10?(s.line++,s.column=1):s.column++,n++;return T[e]=s,s}function U(e,s){var n=Ae(e),i=Ae(s);return{source:m,start:{offset:e,line:n.line,column:n.column},end:{offset:s,line:i.line,column:i.column}}}function l(e){t<E||(t>E&&(E=t,G=[]),G.push(e))}function js(e,s,n){return new I(I.buildMessage(e,s),e,s,n)}function Ce(){var e;return e=gt(),e}function F(){var e,s;return f++,e=t,be(),s=z(),s!==r?(Os(),ks(),g=e,e=Ur()):(t=e,e=r),f--,e===r&&f===0&&l(tr),e}function Ps(){var e;return a.charCodeAt(t)===46?(e=$,t++):(e=r,f===0&&l(ge)),e}function Ss(){var e;return Ye.test(a.charAt(t))?(e=a.charAt(t),t++):(e=r,f===0&&l(nr)),e}function Rs(){var e;return er.test(a.charAt(t))?(e=a.charAt(t),t++):(e=r,f===0&&l(ar)),e}function ks(){var e,s,n,i,c;if(e=t,s=Rs(),s!==r){if(n=be(),n===r&&(n=Ds()),n===r&&(n=null),i=[],c=R(),c!==r)for(;c!==r;)i.push(c),c=R();else i=r;i!==r?(s=[s,n,i],e=s):(t=e,e=r)}else t=e,e=r;return e}function Os(){var e,s,n,i;if(e=t,s=Ps(),s!==r){if(n=[],i=R(),i!==r)for(;i!==r;)n.push(i),i=R();else n=r;n!==r?(s=[s,n],e=s):(t=e,e=r)}else t=e,e=r;return e}function z(){var e,s,n,i;if(e=qs(),e===r)if(e=t,s=Ss(),s!==r){for(n=[],i=R();i!==r;)n.push(i),i=R();s=[s,n],e=s}else t=e,e=r;return e}function be(){var e;return a.charCodeAt(t)===45?(e=y,t++):(e=r,f===0&&l(ve)),e}function Ds(){var e;return a.charCodeAt(t)===43?(e=d,t++):(e=r,f===0&&l(ir)),e}function qs(){var e;return a.charCodeAt(t)===48?(e=v,t++):(e=r,f===0&&l(fr)),e}function R(){var e;return rr.test(a.charAt(t))?(e=a.charAt(t),t++):(e=r,f===0&&l(lr)),e}function u(){var e,s;for(f++,e=[],ue.test(a.charAt(t))?(s=a.charAt(t),t++):(s=r,f===0&&l($e));s!==r;)e.push(s),ue.test(a.charAt(t))?(s=a.charAt(t),t++):(s=r,f===0&&l($e));return f--,s=r,f===0&&l(or),e}function k(){var e,s,n,i;return e=t,s=u(),a.charCodeAt(t)===44?(n=h,t++):(n=r,f===0&&l(cr)),n!==r?(i=u(),s=[s,n,i],e=s):(t=e,e=r),e}function xe(){var e,s,n,i;return e=t,s=u(),a.charCodeAt(t)===124?(n=C,t++):(n=r,f===0&&l(ur)),n!==r?(i=u(),s=[s,n,i],e=s):(t=e,e=r),e}function O(){var e;return a.charCodeAt(t)===34?(e=P,t++):(e=r,f===0&&l(pr)),e===r&&(a.charCodeAt(t)===39?(e=qe,t++):(e=r,f===0&&l(gr))),e}function L(){var e;return sr.test(a.charAt(t))?(e=a.charAt(t),t++):(e=r,f===0&&l(vr)),e===r&&(a.charCodeAt(t)===45?(e=y,t++):(e=r,f===0&&l(ve)),e===r&&(a.charCodeAt(t)===35?(e=Ie,t++):(e=r,f===0&&l($r)),e===r&&(a.charCodeAt(t)===46?(e=$,t++):(e=r,f===0&&l(ge)),e===r&&(a.charCodeAt(t)===94?(e=Ne,t++):(e=r,f===0&&l(hr)),e===r&&(a.charCodeAt(t)===95?(e=Te,t++):(e=r,f===0&&l(mr)),e===r&&(a.charCodeAt(t)===58?(e=Be,t++):(e=r,f===0&&l(_r)))))))),e}function Ee(){var e,s,n;if(e=t,u(),s=[],n=L(),n!==r)for(;n!==r;)s.push(n),n=L();else s=r;return s!==r?(n=u(),g=e,e=Xr(s)):(t=e,e=r),e}function Is(){var e,s,n,i;return e=t,u(),a.charCodeAt(t)===91?(s=Q,t++):(s=r,f===0&&l(he)),s!==r?(u(),n=je(),n!==r?(u(),a.charCodeAt(t)===93?(i=V,t++):(i=r,f===0&&l(me)),i!==r?(u(),g=e,e=Hr(n)):(t=e,e=r)):(t=e,e=r)):(t=e,e=r),e}function Ns(){var e,s,n,i,c;return e=t,u(),a.charCodeAt(t)===123?(s=ze,t++):(s=r,f===0&&l(dr)),s!==r?(u(),n=Js(),n!==r?(u(),a.charCodeAt(t)===125?(i=Le,t++):(i=r,f===0&&l(wr)),i!==r?(c=Ts(),c===r&&(c=null),u(),g=e,e=Jr(n,c)):(t=e,e=r)):(t=e,e=r)):(t=e,e=r),e}function Ts(){var e,s,n;return e=t,a.charCodeAt(t)===37?(s=Me,t++):(s=r,f===0&&l(yr)),s!==r?(n=M(),n!==r?(g=e,e=Kr(n)):(t=e,e=r)):(t=e,e=r),e}function Bs(){var e,s,n,i;return e=t,u(),a.charCodeAt(t)===60?(s=Ze,t++):(s=r,f===0&&l(Ar)),s!==r?(u(),n=j(),n!==r?(u(),a.charCodeAt(t)===62?(i=Ge,t++):(i=r,f===0&&l(Cr)),i!==r?(u(),g=e,e=Qr(n)):(t=e,e=r)):(t=e,e=r)):(t=e,e=r),e}function M(){var e;return e=Ee(),e===r&&(e=Is(),e===r&&(e=Ns(),e===r&&(e=Bs()))),e}function zs(){var e;return e=Ls(),e===r&&(e=Zs(),e===r&&(e=Gs(),e===r&&(e=Us(),e===r&&(e=Ms(),e===r&&(e=Xs()))))),e}function Ls(){var e,s,n;return e=t,a.charCodeAt(t)===64?(s=Ue,t++):(s=r,f===0&&l(br)),s!==r?(n=F(),n!==r?(g=e,e=Vr(n)):(t=e,e=r)):(t=e,e=r),e}function Ms(){var e,s,n;return e=t,a.charCodeAt(t)===33?(s=Xe,t++):(s=r,f===0&&l(xr)),s!==r?(n=F(),n!==r?(g=e,e=Wr(n)):(t=e,e=r)):(t=e,e=r),e}function Zs(){var e,s,n,i,c,w,x;return e=t,a.charCodeAt(t)===40?(s=He,t++):(s=r,f===0&&l(Er)),s!==r?(u(),n=N(),n!==r?(u(),i=k(),i!==r?(u(),c=N(),c!==r?(u(),k(),u(),w=N(),w===r&&(w=null),u(),a.charCodeAt(t)===41?(x=Je,t++):(x=r,f===0&&l(Fr)),x!==r?(g=e,e=Yr(n,c,w)):(t=e,e=r)):(t=e,e=r)):(t=e,e=r)):(t=e,e=r)):(t=e,e=r),e}function Gs(){var e,s,n;return e=t,a.charCodeAt(t)===47?(s=Ke,t++):(s=r,f===0&&l(jr)),s!==r?(n=M(),n!==r?(g=e,e=es(n)):(t=e,e=r)):(t=e,e=r),e}function Us(){var e,s,n;return e=t,a.charCodeAt(t)===42?(s=Qe,t++):(s=r,f===0&&l(Pr)),s!==r?(n=M(),n!==r?(g=e,e=rs(n)):(t=e,e=r)):(t=e,e=r),e}function Xs(){var e,s,n;return e=t,a.charCodeAt(t)===63?(s=Ve,t++):(s=r,f===0&&l(Sr)),s!==r?(n=F(),n===r&&(n=null),g=e,e=ss(n)):(t=e,e=r),e}function N(){var e,s,n;return e=t,s=M(),s!==r?(n=zs(),n===r&&(n=null),g=e,e=ts(s,n)):(t=e,e=r),e}function j(){var e,s,n;if(e=t,s=[],n=N(),n!==r)for(;n!==r;)s.push(n),n=N();else s=r;return s!==r&&(g=e,s=ns(s)),e=s,e}function Fe(){var e,s,n,i,c;if(e=t,s=[],n=t,i=k(),i!==r?(c=j(),c!==r?n=c:(t=n,n=r)):(t=n,n=r),n!==r)for(;n!==r;)s.push(n),n=t,i=k(),i!==r?(c=j(),c!==r?n=c:(t=n,n=r)):(t=n,n=r);else s=r;return s!==r&&(g=e,s=as(s)),e=s,e}function Hs(){var e,s,n,i,c;if(e=t,s=[],n=t,i=xe(),i!==r?(c=j(),c!==r?n=c:(t=n,n=r)):(t=n,n=r),n!==r)for(;n!==r;)s.push(n),n=t,i=xe(),i!==r?(c=j(),c!==r?n=c:(t=n,n=r)):(t=n,n=r);else s=r;return s!==r&&(g=e,s=is(s)),e=s,e}function je(){var e,s,n;return e=t,s=j(),s!==r?(n=Fe(),n===r&&(n=Hs()),n===r&&(n=null),g=e,e=fs(s,n)):(t=e,e=r),e}function Js(){var e,s,n;return e=t,s=j(),s!==r?(n=Fe(),n===r&&(n=null),g=e,e=ls(s,n)):(t=e,e=r),e}function Ks(){var e,s,n,i;return e=t,u(),s=O(),s!==r?(n=je(),n!==r?(i=O(),i!==r?(g=e,e=os(n)):(t=e,e=r)):(t=e,e=r)):(t=e,e=r),e}function Qs(){var e;return e=nt(),e===r&&(e=et(),e===r&&(e=tt(),e===r&&(e=Ws(),e===r&&(e=Ys(),e===r&&(e=Vs(),e===r&&(e=st(),e===r&&(e=rt()))))))),e}function Vs(){var e,s,n;return e=t,a.substr(t,6)===W?(s=W,t+=6):(s=r,f===0&&l(Rr)),s!==r?(u(),n=D(),n!==r?(g=e,e=cs(n)):(t=e,e=r)):(t=e,e=r),e}function Ws(){var e,s,n,i,c;return e=t,a.substr(t,6)===Y?(s=Y,t+=6):(s=r,f===0&&l(kr)),s!==r?(u(),n=O(),n!==r?(i=Ee(),i!==r?(c=O(),c!==r?(g=e,e=us(i)):(t=e,e=r)):(t=e,e=r)):(t=e,e=r)):(t=e,e=r),e}function Ys(){var e,s,n,i;return e=t,a.substr(t,6)===ee?(s=ee,t+=6):(s=r,f===0&&l(Or)),s!==r?(u(),n=z(),n!==r?(u(),i=z(),i!==r?(u(),z(),g=e,e=ps(n,i)):(t=e,e=r)):(t=e,e=r)):(t=e,e=r),e}function et(){var e,s,n;return e=t,a.substr(t,4)===re?(s=re,t+=4):(s=r,f===0&&l(Dr)),s!==r?(u(),n=F(),n!==r?(g=e,e=gs(n)):(t=e,e=r)):(t=e,e=r),e}function rt(){var e,s,n;return e=t,a.substr(t,4)===se?(s=se,t+=4):(s=r,f===0&&l(qr)),s!==r?(u(),n=F(),n!==r?(g=e,e=vs(n)):(t=e,e=r)):(t=e,e=r),e}function st(){var e,s,n;return e=t,a.substr(t,4)===te?(s=te,t+=4):(s=r,f===0&&l(Ir)),s!==r?(u(),n=F(),n!==r?(g=e,e=$s(n)):(t=e,e=r)):(t=e,e=r),e}function tt(){var e,s,n;return e=t,a.substr(t,4)===ne?(s=ne,t+=4):(s=r,f===0&&l(Nr)),s!==r?(u(),n=F(),n!==r?(g=e,e=hs(n)):(t=e,e=r)):(t=e,e=r),e}function nt(){var e,s,n,i,c;if(e=t,a.substr(t,5)===ae?(s=ae,t+=5):(s=r,f===0&&l(Tr)),s!==r)if(u(),n=O(),n!==r){if(i=[],c=L(),c!==r)for(;c!==r;)i.push(c),c=L();else i=r;i!==r?(c=O(),c!==r?(g=e,e=ms(i)):(t=e,e=r)):(t=e,e=r)}else t=e,e=r;else t=e,e=r;return e}function X(){var e,s,n,i;if(e=t,a.substr(t,2)===ie?(s=ie,t+=2):(s=r,f===0&&l(Br)),s!==r){for(n=[],pe.test(a.charAt(t))?(i=a.charAt(t),t++):(i=r,f===0&&l(_e));i!==r;)n.push(i),pe.test(a.charAt(t))?(i=a.charAt(t),t++):(i=r,f===0&&l(_e));s=[s,n],e=s}else t=e,e=r;return e}function at(){var e,s,n,i,c,w,x,q;if(e=t,a.substr(t,3)===fe?(s=fe,t+=3):(s=r,f===0&&l(zr)),s!==r)if(u(),a.charCodeAt(t)===91?(n=Q,t++):(n=r,f===0&&l(he)),n!==r)if(u(),i=D(),i!==r){for(c=[],w=t,x=k(),x!==r?(q=D(),q!==r?(g=w,w=de(i,q)):(t=w,w=r)):(t=w,w=r);w!==r;)c.push(w),w=t,x=k(),x!==r?(q=D(),q!==r?(g=w,w=de(i,q)):(t=w,w=r)):(t=w,w=r);w=u(),a.charCodeAt(t)===93?(x=V,t++):(x=r,f===0&&l(me)),x!==r?(g=e,e=_s(i,c)):(t=e,e=r)}else t=e,e=r;else t=e,e=r;else t=e,e=r;return e}function it(){var e;return e=at(),e===r&&(e=Ks()),e}function D(){var e,s,n,i,c;if(e=t,s=it(),s!==r){for(u(),n=[],i=X();i!==r;)n.push(i),i=X();g=e,e=ds(s)}else t=e,e=r;return e===r&&(e=t,s=Qs(),s!==r?(u(),a.charCodeAt(t)===36?(n=We,t++):(n=r,f===0&&l(Lr)),n!==r?(i=u(),c=D(),c!==r?(g=e,e=ws(s,c)):(t=e,e=r)):(t=e,e=r)):(t=e,e=r)),e}function ft(){var e,s;return e=t,s=D(),s!==r&&(g=e,s=ys(s)),e=s,e===r&&(e=X()),e}function lt(){var e;return e=ft(),e}function ot(){var e,s;return e=t,u(),s=ct(),s===r&&(s=ut(),s===r&&(s=pt())),s!==r?(u(),g=e,e=As(s)):(t=e,e=r),e}function ct(){var e,s,n;return e=t,a.substr(t,6)===le?(s=le,t+=6):(s=r,f===0&&l(Mr)),s!==r?(u(),n=F(),n!==r?(g=e,e=Cs(n)):(t=e,e=r)):(t=e,e=r),e}function ut(){var e,s,n;return e=t,a.substr(t,6)===oe?(s=oe,t+=6):(s=r,f===0&&l(Zr)),s!==r?(u(),n=F(),n!==r?(g=e,e=bs(n)):(t=e,e=r)):(t=e,e=r),e}function pt(){var e,s;return e=t,a.substr(t,4)===ce?(s=ce,t+=4):(s=r,f===0&&l(Gr)),s!==r&&(g=e,s=xs()),e=s,e}function gt(){var e;return e=lt(),e===r&&(e=ot()),e}var vt=function(e){this.type_="atom",this.source_=e,this.location_=we()},Z=function(e,s){this.type_="pattern",this.arguments_={alignment:s},this.source_=e},$t=function(e,s,n){this.type_=e,this.arguments_=s,this.source_=n},ht=function(e,s){this.type_="element",this.source_=e,this.options_=s,this.location_=we()},H=function(e,s){this.type_="command",this.name_=e,this.options_=s};if(B=A(),B!==r&&t===a.length)return B;throw B!==r&&t<a.length&&l(Fs()),js(G,E<a.length?a.charAt(E):null,E<a.length?U(E,E+1):U(E,E))}const At=(a,o)=>(r,m)=>{const A=a.source_[m].options_,$=A?.operator;if($){switch($.type_){case"stretch":{const d=["fast","slow"],{type:v,amount:h}=$.arguments_;if(!d.includes(v))throw new Error(`mini: stretch: type must be one of ${d.join("|")} but got ${v}`);return K(r)[v](b(h,o))}case"bjorklund":return $.arguments_.rotation?r.euclidRot(b($.arguments_.pulse,o),b($.arguments_.step,o),b($.arguments_.rotation,o)):r.euclid(b($.arguments_.pulse,o),b($.arguments_.step,o));case"degradeBy":return K(r).degradeBy($.arguments_.amount===null?.5:$.arguments_.amount)}console.warn(`operator "${$.type_}" not implemented`)}if(A?.weight)return r;const y=Object.keys(A||{}).filter(d=>d!=="operator");return y.length&&console.warn(`option${y.length>1?"s":""} ${y.map(d=>`"${d}"`).join(", ")} not implemented`),r};function Ct(a){a.source_=wt(a.source_.map(o=>{const{replicate:r,...m}=o.options_||{};return r?(delete o.options_.replicate,Array(r).fill(o)):[o]}))}function b(a,o){switch(a.type_){case"pattern":{Ct(a);const r=a.source_.map($=>b($,o)).map(At(a,o)),m=a.arguments_.alignment;if(m==="stack")return Re(...r);if(m==="polymeter"){const $=a.arguments_.stepsPerCycle?b(a.arguments_.stepsPerCycle,o).fmap(d=>ke(d)):Se(ke(r.length>0?r[0].__weight:1)),y=r.map(d=>d.fast($.fmap(v=>v.div(d.__weight||1))));return Re(...y)}if(m==="rand")return mt(...r);const _=a.source_.some($=>!!$.options_?.weight);if(!_&&m==="slowcat")return _t(...r);if(_){const $=a.source_.reduce((d,v)=>d+(v.options_?.weight||1),0),y=dt(...a.source_.map((d,v)=>[d.options_?.weight||1,r[v]]));return m==="slowcat"?y._slow($):(y.__weight=$,y)}const A=Oe(...r);return A.__weight=r.length,A}case"element":return b(a.source_,o);case"atom":{if(a.source_==="~")return Pe;if(!a.location_)return console.warn("no location for",a),a.source_;const{start:r,end:m}=a.location_,_=isNaN(Number(a.source_))?a.source_:Number(a.source_),A=o?.split("").slice(r.offset,m.offset).join(""),[$=0,y=0]=A?A.split(a.source_).map(d=>d.split("").filter(v=>v===" ").length):[];return Se(_).withLocation([r.line,r.column+$,r.offset+$],[r.line,m.column-y,m.offset-y])}case"stretch":return b(a.source_,o).slow(b(a.arguments_.amount,o));default:return console.warn(`node type "${a.type_}" not implemented -> returning silence`),Pe}}const bt=(...a)=>{const o=a.map(r=>{const m=`"${r}"`,_=De(m);return b(_,m)});return Oe(...o)},Ft=a=>{const o=De(a);return b(o,a)};function jt(a){return typeof a=="string"?bt(a):K(a)}export{I as SyntaxError,Ft as h,bt as mini,jt as minify,De as parse,b as patternifyAST};
