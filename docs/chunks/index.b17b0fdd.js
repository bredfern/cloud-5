import{m as Se,n as Re,s as ke,o as De,q as mt,t as _t,u as dt,v as Oe,x as K,y as wt}from"./prebake.1f1d1680.js";import"./index.f1bb492c.js";function yt(a,l){function r(){this.constructor=a}r.prototype=l.prototype,a.prototype=new r}function I(a,l,r,h){var m=Error.call(this,a);return Object.setPrototypeOf&&Object.setPrototypeOf(m,I.prototype),m.expected=l,m.found=r,m.location=h,m.name="SyntaxError",m}yt(I,Error);function J(a,l,r){return r=r||" ",a.length>l?a:(l-=a.length,r+=r.repeat(l),a+r.slice(0,l))}I.prototype.format=function(a){var l="Error: "+this.message;if(this.location){var r=null,h;for(h=0;h<a.length;h++)if(a[h].source===this.location.source){r=a[h].text.split(/\r\n|\n|\r/g);break}var m=this.location.start,A=this.location.source+":"+m.line+":"+m.column;if(r){var d=this.location.end,_=J("",m.line.toString().length," "),y=r[m.line-1],v=m.line===d.line?d.column:y.length+1,$=v-m.column||1;l+=`
 --> `+A+`
`+_+` |
`+m.line+" | "+y+`
`+_+" | "+J("",m.column-1," ")+J("",$,"^")}else l+=`
 at `+A}return l};I.buildMessage=function(a,l){var r={literal:function(v){return'"'+m(v.text)+'"'},class:function(v){var $=v.parts.map(function(C){return Array.isArray(C)?A(C[0])+"-"+A(C[1]):A(C)});return"["+(v.inverted?"^":"")+$.join("")+"]"},any:function(){return"any character"},end:function(){return"end of input"},other:function(v){return v.description}};function h(v){return v.charCodeAt(0).toString(16).toUpperCase()}function m(v){return v.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function($){return"\\x0"+h($)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function($){return"\\x"+h($)})}function A(v){return v.replace(/\\/g,"\\\\").replace(/\]/g,"\\]").replace(/\^/g,"\\^").replace(/-/g,"\\-").replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function($){return"\\x0"+h($)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function($){return"\\x"+h($)})}function d(v){return r[v.type](v)}function _(v){var $=v.map(d),C,P;if($.sort(),$.length>0){for(C=1,P=1;C<$.length;C++)$[C-1]!==$[C]&&($[P]=$[C],P++);$.length=P}switch($.length){case 1:return $[0];case 2:return $[0]+" or "+$[1];default:return $.slice(0,-1).join(", ")+", or "+$[$.length-1]}}function y(v){return v?'"'+m(v)+'"':"end of input"}return"Expected "+_(a)+" but "+y(l)+" found."};function qe(a,l){l=l!==void 0?l:{};var r={},h=l.grammarSource,m={start:Ce},A=Ce,d=".",_="-",y="+",v="0",$=",",C="|",P='"',Ie="'",Ne="#",Te="^",Be="_",ze=":",Q="[",V="]",Le="{",Me="}",Ze="%",Ge="<",Ue=">",Xe="@",He="!",Je="(",Ke=")",Qe="/",Ve="*",We="?",W="struct",Y="target",ee="euclid",re="slow",se="rotL",te="rotR",ne="fast",ae="scale",ie="//",fe="cat",Ye="$",oe="setcps",le="setbpm",ce="hush",er=/^[1-9]/,rr=/^[eE]/,sr=/^[0-9]/,ue=/^[ \n\r\t]/,tr=/^[0-9a-zA-Z~]/,pe=/^[^\n]/,nr=ye("number"),ge=p(".",!1),ar=S([["1","9"]],!1,!1),ir=S(["e","E"],!1,!1),ve=p("-",!1),fr=p("+",!1),or=p("0",!1),lr=S([["0","9"]],!1,!1),cr=ye("whitespace"),$e=S([" ",`
`,"\r","	"],!1,!1),ur=p(",",!1),pr=p("|",!1),gr=p('"',!1),vr=p("'",!1),$r=S([["0","9"],["a","z"],["A","Z"],"~"],!1,!1),hr=p("#",!1),mr=p("^",!1),_r=p("_",!1),dr=p(":",!1),he=p("[",!1),me=p("]",!1),wr=p("{",!1),yr=p("}",!1),Ar=p("%",!1),Cr=p("<",!1),br=p(">",!1),xr=p("@",!1),Er=p("!",!1),Fr=p("(",!1),jr=p(")",!1),Pr=p("/",!1),Sr=p("*",!1),Rr=p("?",!1),kr=p("struct",!1),Dr=p("target",!1),Or=p("euclid",!1),qr=p("slow",!1),Ir=p("rotL",!1),Nr=p("rotR",!1),Tr=p("fast",!1),Br=p("scale",!1),zr=p("//",!1),_e=S([`
`],!0,!1),Lr=p("cat",!1),Mr=p("$",!1),Zr=p("setcps",!1),Gr=p("setbpm",!1),Ur=p("hush",!1),Xr=function(){return parseFloat(Fs())},Hr=function(e){return new vt(e.join(""))},Jr=function(e){return e},Kr=function(e,s){return e.arguments_.stepsPerCycle=s,e},Qr=function(e){return e},Vr=function(e){return e.arguments_.alignment="slowcat",e},Wr=function(e){return s=>s.options_.weight=e},Yr=function(e){return s=>s.options_.reps=e},es=function(e,s,n){return i=>i.options_.ops.push({type_:"bjorklund",arguments_:{pulse:e,step:s,rotation:n}})},rs=function(e){return s=>s.options_.ops.push({type_:"stretch",arguments_:{amount:e,type:"slow"}})},ss=function(e){return s=>s.options_.ops.push({type_:"stretch",arguments_:{amount:e,type:"fast"}})},ts=function(e){return s=>s.options_.ops.push({type_:"degradeBy",arguments_:{amount:e}})},ns=function(e,s){const n=new ht(e,{ops:[],weight:1,reps:1});for(const i of s)i(n);return n},as=function(e){return new Z(e,"fastcat")},is=function(e){return{alignment:"stack",list:e}},fs=function(e){return{alignment:"rand",list:e}},os=function(e,s){return s&&s.list.length>0?new Z([e,...s.list],s.alignment):e},ls=function(e,s){return new Z(s?[e,...s.list]:[e],"polymeter")},cs=function(e){return e},us=function(e){return{name:"struct",args:{mini:e}}},ps=function(e){return{name:"target",args:{name:e}}},gs=function(e,s,n){return{name:"bjorklund",args:{pulse:e,step:parseInt(s)}}},vs=function(e){return{name:"stretch",args:{amount:e}}},$s=function(e){return{name:"shift",args:{amount:"-"+e}}},hs=function(e){return{name:"shift",args:{amount:e}}},ms=function(e){return{name:"stretch",args:{amount:"1/"+e}}},_s=function(e){return{name:"scale",args:{scale:e.join("")}}},de=function(e,s){return s},ds=function(e,s){return s.unshift(e),new Z(s,"slowcat")},ws=function(e){return e},ys=function(e,s){return new $t(e.name,e.args,s)},As=function(e){return e},Cs=function(e){return e},bs=function(e){return new H("setcps",{value:e})},xs=function(e){return new H("setcps",{value:e/120/2})},Es=function(){return new H("hush")},t=0,g=0,T=[{line:1,column:1}],E=0,G=[],f=0,B;if("startRule"in l){if(!(l.startRule in m))throw new Error(`Can't start parsing from rule "`+l.startRule+'".');A=m[l.startRule]}function Fs(){return a.substring(g,t)}function we(){return U(g,t)}function p(e,s){return{type:"literal",text:e,ignoreCase:s}}function S(e,s,n){return{type:"class",parts:e,inverted:s,ignoreCase:n}}function js(){return{type:"end"}}function ye(e){return{type:"other",description:e}}function Ae(e){var s=T[e],n;if(s)return s;for(n=e-1;!T[n];)n--;for(s=T[n],s={line:s.line,column:s.column};n<e;)a.charCodeAt(n)===10?(s.line++,s.column=1):s.column++,n++;return T[e]=s,s}function U(e,s){var n=Ae(e),i=Ae(s);return{source:h,start:{offset:e,line:n.line,column:n.column},end:{offset:s,line:i.line,column:i.column}}}function o(e){t<E||(t>E&&(E=t,G=[]),G.push(e))}function Ps(e,s,n){return new I(I.buildMessage(e,s),e,s,n)}function Ce(){var e;return e=gt(),e}function F(){var e,s;return f++,e=t,be(),s=z(),s!==r?(Os(),Ds(),g=e,e=Xr()):(t=e,e=r),f--,e===r&&f===0&&o(nr),e}function Ss(){var e;return a.charCodeAt(t)===46?(e=d,t++):(e=r,f===0&&o(ge)),e}function Rs(){var e;return er.test(a.charAt(t))?(e=a.charAt(t),t++):(e=r,f===0&&o(ar)),e}function ks(){var e;return rr.test(a.charAt(t))?(e=a.charAt(t),t++):(e=r,f===0&&o(ir)),e}function Ds(){var e,s,n,i,c;if(e=t,s=ks(),s!==r){if(n=be(),n===r&&(n=qs()),n===r&&(n=null),i=[],c=R(),c!==r)for(;c!==r;)i.push(c),c=R();else i=r;i!==r?(s=[s,n,i],e=s):(t=e,e=r)}else t=e,e=r;return e}function Os(){var e,s,n,i;if(e=t,s=Ss(),s!==r){if(n=[],i=R(),i!==r)for(;i!==r;)n.push(i),i=R();else n=r;n!==r?(s=[s,n],e=s):(t=e,e=r)}else t=e,e=r;return e}function z(){var e,s,n,i;if(e=Is(),e===r)if(e=t,s=Rs(),s!==r){for(n=[],i=R();i!==r;)n.push(i),i=R();s=[s,n],e=s}else t=e,e=r;return e}function be(){var e;return a.charCodeAt(t)===45?(e=_,t++):(e=r,f===0&&o(ve)),e}function qs(){var e;return a.charCodeAt(t)===43?(e=y,t++):(e=r,f===0&&o(fr)),e}function Is(){var e;return a.charCodeAt(t)===48?(e=v,t++):(e=r,f===0&&o(or)),e}function R(){var e;return sr.test(a.charAt(t))?(e=a.charAt(t),t++):(e=r,f===0&&o(lr)),e}function u(){var e,s;for(f++,e=[],ue.test(a.charAt(t))?(s=a.charAt(t),t++):(s=r,f===0&&o($e));s!==r;)e.push(s),ue.test(a.charAt(t))?(s=a.charAt(t),t++):(s=r,f===0&&o($e));return f--,s=r,f===0&&o(cr),e}function k(){var e,s,n,i;return e=t,s=u(),a.charCodeAt(t)===44?(n=$,t++):(n=r,f===0&&o(ur)),n!==r?(i=u(),s=[s,n,i],e=s):(t=e,e=r),e}function xe(){var e,s,n,i;return e=t,s=u(),a.charCodeAt(t)===124?(n=C,t++):(n=r,f===0&&o(pr)),n!==r?(i=u(),s=[s,n,i],e=s):(t=e,e=r),e}function D(){var e;return a.charCodeAt(t)===34?(e=P,t++):(e=r,f===0&&o(gr)),e===r&&(a.charCodeAt(t)===39?(e=Ie,t++):(e=r,f===0&&o(vr))),e}function L(){var e;return tr.test(a.charAt(t))?(e=a.charAt(t),t++):(e=r,f===0&&o($r)),e===r&&(a.charCodeAt(t)===45?(e=_,t++):(e=r,f===0&&o(ve)),e===r&&(a.charCodeAt(t)===35?(e=Ne,t++):(e=r,f===0&&o(hr)),e===r&&(a.charCodeAt(t)===46?(e=d,t++):(e=r,f===0&&o(ge)),e===r&&(a.charCodeAt(t)===94?(e=Te,t++):(e=r,f===0&&o(mr)),e===r&&(a.charCodeAt(t)===95?(e=Be,t++):(e=r,f===0&&o(_r)),e===r&&(a.charCodeAt(t)===58?(e=ze,t++):(e=r,f===0&&o(dr)))))))),e}function Ee(){var e,s,n;if(e=t,u(),s=[],n=L(),n!==r)for(;n!==r;)s.push(n),n=L();else s=r;return s!==r?(n=u(),g=e,e=Hr(s)):(t=e,e=r),e}function Ns(){var e,s,n,i;return e=t,u(),a.charCodeAt(t)===91?(s=Q,t++):(s=r,f===0&&o(he)),s!==r?(u(),n=Pe(),n!==r?(u(),a.charCodeAt(t)===93?(i=V,t++):(i=r,f===0&&o(me)),i!==r?(u(),g=e,e=Jr(n)):(t=e,e=r)):(t=e,e=r)):(t=e,e=r),e}function Ts(){var e,s,n,i,c;return e=t,u(),a.charCodeAt(t)===123?(s=Le,t++):(s=r,f===0&&o(wr)),s!==r?(u(),n=Js(),n!==r?(u(),a.charCodeAt(t)===125?(i=Me,t++):(i=r,f===0&&o(yr)),i!==r?(c=Bs(),c===r&&(c=null),u(),g=e,e=Kr(n,c)):(t=e,e=r)):(t=e,e=r)):(t=e,e=r),e}function Bs(){var e,s,n;return e=t,a.charCodeAt(t)===37?(s=Ze,t++):(s=r,f===0&&o(Ar)),s!==r?(n=M(),n!==r?(g=e,e=Qr(n)):(t=e,e=r)):(t=e,e=r),e}function zs(){var e,s,n,i;return e=t,u(),a.charCodeAt(t)===60?(s=Ge,t++):(s=r,f===0&&o(Cr)),s!==r?(u(),n=j(),n!==r?(u(),a.charCodeAt(t)===62?(i=Ue,t++):(i=r,f===0&&o(br)),i!==r?(u(),g=e,e=Vr(n)):(t=e,e=r)):(t=e,e=r)):(t=e,e=r),e}function M(){var e;return e=Ee(),e===r&&(e=Ns(),e===r&&(e=Ts(),e===r&&(e=zs()))),e}function Fe(){var e;return e=Ls(),e===r&&(e=Zs(),e===r&&(e=Gs(),e===r&&(e=Us(),e===r&&(e=Ms(),e===r&&(e=Xs()))))),e}function Ls(){var e,s,n;return e=t,a.charCodeAt(t)===64?(s=Xe,t++):(s=r,f===0&&o(xr)),s!==r?(n=F(),n!==r?(g=e,e=Wr(n)):(t=e,e=r)):(t=e,e=r),e}function Ms(){var e,s,n;return e=t,a.charCodeAt(t)===33?(s=He,t++):(s=r,f===0&&o(Er)),s!==r?(n=F(),n!==r?(g=e,e=Yr(n)):(t=e,e=r)):(t=e,e=r),e}function Zs(){var e,s,n,i,c,w,x;return e=t,a.charCodeAt(t)===40?(s=Je,t++):(s=r,f===0&&o(Fr)),s!==r?(u(),n=N(),n!==r?(u(),i=k(),i!==r?(u(),c=N(),c!==r?(u(),k(),u(),w=N(),w===r&&(w=null),u(),a.charCodeAt(t)===41?(x=Ke,t++):(x=r,f===0&&o(jr)),x!==r?(g=e,e=es(n,c,w)):(t=e,e=r)):(t=e,e=r)):(t=e,e=r)):(t=e,e=r)):(t=e,e=r),e}function Gs(){var e,s,n;return e=t,a.charCodeAt(t)===47?(s=Qe,t++):(s=r,f===0&&o(Pr)),s!==r?(n=M(),n!==r?(g=e,e=rs(n)):(t=e,e=r)):(t=e,e=r),e}function Us(){var e,s,n;return e=t,a.charCodeAt(t)===42?(s=Ve,t++):(s=r,f===0&&o(Sr)),s!==r?(n=M(),n!==r?(g=e,e=ss(n)):(t=e,e=r)):(t=e,e=r),e}function Xs(){var e,s,n;return e=t,a.charCodeAt(t)===63?(s=We,t++):(s=r,f===0&&o(Rr)),s!==r?(n=F(),n===r&&(n=null),g=e,e=ts(n)):(t=e,e=r),e}function N(){var e,s,n,i;if(e=t,s=M(),s!==r){for(n=[],i=Fe();i!==r;)n.push(i),i=Fe();g=e,e=ns(s,n)}else t=e,e=r;return e}function j(){var e,s,n;if(e=t,s=[],n=N(),n!==r)for(;n!==r;)s.push(n),n=N();else s=r;return s!==r&&(g=e,s=as(s)),e=s,e}function je(){var e,s,n,i,c;if(e=t,s=[],n=t,i=k(),i!==r?(c=j(),c!==r?n=c:(t=n,n=r)):(t=n,n=r),n!==r)for(;n!==r;)s.push(n),n=t,i=k(),i!==r?(c=j(),c!==r?n=c:(t=n,n=r)):(t=n,n=r);else s=r;return s!==r&&(g=e,s=is(s)),e=s,e}function Hs(){var e,s,n,i,c;if(e=t,s=[],n=t,i=xe(),i!==r?(c=j(),c!==r?n=c:(t=n,n=r)):(t=n,n=r),n!==r)for(;n!==r;)s.push(n),n=t,i=xe(),i!==r?(c=j(),c!==r?n=c:(t=n,n=r)):(t=n,n=r);else s=r;return s!==r&&(g=e,s=fs(s)),e=s,e}function Pe(){var e,s,n;return e=t,s=j(),s!==r?(n=je(),n===r&&(n=Hs()),n===r&&(n=null),g=e,e=os(s,n)):(t=e,e=r),e}function Js(){var e,s,n;return e=t,s=j(),s!==r?(n=je(),n===r&&(n=null),g=e,e=ls(s,n)):(t=e,e=r),e}function Ks(){var e,s,n,i;return e=t,u(),s=D(),s!==r?(n=Pe(),n!==r?(i=D(),i!==r?(g=e,e=cs(n)):(t=e,e=r)):(t=e,e=r)):(t=e,e=r),e}function Qs(){var e;return e=nt(),e===r&&(e=et(),e===r&&(e=tt(),e===r&&(e=Ws(),e===r&&(e=Ys(),e===r&&(e=Vs(),e===r&&(e=st(),e===r&&(e=rt()))))))),e}function Vs(){var e,s,n;return e=t,a.substr(t,6)===W?(s=W,t+=6):(s=r,f===0&&o(kr)),s!==r?(u(),n=O(),n!==r?(g=e,e=us(n)):(t=e,e=r)):(t=e,e=r),e}function Ws(){var e,s,n,i,c;return e=t,a.substr(t,6)===Y?(s=Y,t+=6):(s=r,f===0&&o(Dr)),s!==r?(u(),n=D(),n!==r?(i=Ee(),i!==r?(c=D(),c!==r?(g=e,e=ps(i)):(t=e,e=r)):(t=e,e=r)):(t=e,e=r)):(t=e,e=r),e}function Ys(){var e,s,n,i;return e=t,a.substr(t,6)===ee?(s=ee,t+=6):(s=r,f===0&&o(Or)),s!==r?(u(),n=z(),n!==r?(u(),i=z(),i!==r?(u(),z(),g=e,e=gs(n,i)):(t=e,e=r)):(t=e,e=r)):(t=e,e=r),e}function et(){var e,s,n;return e=t,a.substr(t,4)===re?(s=re,t+=4):(s=r,f===0&&o(qr)),s!==r?(u(),n=F(),n!==r?(g=e,e=vs(n)):(t=e,e=r)):(t=e,e=r),e}function rt(){var e,s,n;return e=t,a.substr(t,4)===se?(s=se,t+=4):(s=r,f===0&&o(Ir)),s!==r?(u(),n=F(),n!==r?(g=e,e=$s(n)):(t=e,e=r)):(t=e,e=r),e}function st(){var e,s,n;return e=t,a.substr(t,4)===te?(s=te,t+=4):(s=r,f===0&&o(Nr)),s!==r?(u(),n=F(),n!==r?(g=e,e=hs(n)):(t=e,e=r)):(t=e,e=r),e}function tt(){var e,s,n;return e=t,a.substr(t,4)===ne?(s=ne,t+=4):(s=r,f===0&&o(Tr)),s!==r?(u(),n=F(),n!==r?(g=e,e=ms(n)):(t=e,e=r)):(t=e,e=r),e}function nt(){var e,s,n,i,c;if(e=t,a.substr(t,5)===ae?(s=ae,t+=5):(s=r,f===0&&o(Br)),s!==r)if(u(),n=D(),n!==r){if(i=[],c=L(),c!==r)for(;c!==r;)i.push(c),c=L();else i=r;i!==r?(c=D(),c!==r?(g=e,e=_s(i)):(t=e,e=r)):(t=e,e=r)}else t=e,e=r;else t=e,e=r;return e}function X(){var e,s,n,i;if(e=t,a.substr(t,2)===ie?(s=ie,t+=2):(s=r,f===0&&o(zr)),s!==r){for(n=[],pe.test(a.charAt(t))?(i=a.charAt(t),t++):(i=r,f===0&&o(_e));i!==r;)n.push(i),pe.test(a.charAt(t))?(i=a.charAt(t),t++):(i=r,f===0&&o(_e));s=[s,n],e=s}else t=e,e=r;return e}function at(){var e,s,n,i,c,w,x,q;if(e=t,a.substr(t,3)===fe?(s=fe,t+=3):(s=r,f===0&&o(Lr)),s!==r)if(u(),a.charCodeAt(t)===91?(n=Q,t++):(n=r,f===0&&o(he)),n!==r)if(u(),i=O(),i!==r){for(c=[],w=t,x=k(),x!==r?(q=O(),q!==r?(g=w,w=de(i,q)):(t=w,w=r)):(t=w,w=r);w!==r;)c.push(w),w=t,x=k(),x!==r?(q=O(),q!==r?(g=w,w=de(i,q)):(t=w,w=r)):(t=w,w=r);w=u(),a.charCodeAt(t)===93?(x=V,t++):(x=r,f===0&&o(me)),x!==r?(g=e,e=ds(i,c)):(t=e,e=r)}else t=e,e=r;else t=e,e=r;else t=e,e=r;return e}function it(){var e;return e=at(),e===r&&(e=Ks()),e}function O(){var e,s,n,i,c;if(e=t,s=it(),s!==r){for(u(),n=[],i=X();i!==r;)n.push(i),i=X();g=e,e=ws(s)}else t=e,e=r;return e===r&&(e=t,s=Qs(),s!==r?(u(),a.charCodeAt(t)===36?(n=Ye,t++):(n=r,f===0&&o(Mr)),n!==r?(i=u(),c=O(),c!==r?(g=e,e=ys(s,c)):(t=e,e=r)):(t=e,e=r)):(t=e,e=r)),e}function ft(){var e,s;return e=t,s=O(),s!==r&&(g=e,s=As(s)),e=s,e===r&&(e=X()),e}function ot(){var e;return e=ft(),e}function lt(){var e,s;return e=t,u(),s=ct(),s===r&&(s=ut(),s===r&&(s=pt())),s!==r?(u(),g=e,e=Cs(s)):(t=e,e=r),e}function ct(){var e,s,n;return e=t,a.substr(t,6)===oe?(s=oe,t+=6):(s=r,f===0&&o(Zr)),s!==r?(u(),n=F(),n!==r?(g=e,e=bs(n)):(t=e,e=r)):(t=e,e=r),e}function ut(){var e,s,n;return e=t,a.substr(t,6)===le?(s=le,t+=6):(s=r,f===0&&o(Gr)),s!==r?(u(),n=F(),n!==r?(g=e,e=xs(n)):(t=e,e=r)):(t=e,e=r),e}function pt(){var e,s;return e=t,a.substr(t,4)===ce?(s=ce,t+=4):(s=r,f===0&&o(Ur)),s!==r&&(g=e,s=Es()),e=s,e}function gt(){var e;return e=ot(),e===r&&(e=lt()),e}var vt=function(e){this.type_="atom",this.source_=e,this.location_=we()},Z=function(e,s){this.type_="pattern",this.arguments_={alignment:s},this.source_=e},$t=function(e,s,n){this.type_=e,this.arguments_=s,this.source_=n},ht=function(e,s){this.type_="element",this.source_=e,this.options_=s,this.location_=we()},H=function(e,s){this.type_="command",this.name_=e,this.options_=s};if(B=A(),B!==r&&t===a.length)return B;throw B!==r&&t<a.length&&o(js()),Ps(G,E<a.length?a.charAt(E):null,E<a.length?U(E,E+1):U(E,E))}const At=(a,l)=>(r,h)=>{const d=a.source_[h].options_?.ops;if(d)for(const _ of d)switch(_.type_){case"stretch":{const y=["fast","slow"],{type:v,amount:$}=_.arguments_;if(!y.includes(v))throw new Error(`mini: stretch: type must be one of ${y.join("|")} but got ${v}`);r=K(r)[v](b($,l));break}case"bjorklund":{_.arguments_.rotation?r=r.euclidRot(b(_.arguments_.pulse,l),b(_.arguments_.step,l),b(_.arguments_.rotation,l)):r=r.euclid(b(_.arguments_.pulse,l),b(_.arguments_.step,l));break}case"degradeBy":{r=K(r).degradeBy(_.arguments_.amount===null?.5:_.arguments_.amount);break}default:console.warn(`operator "${_.type_}" not implemented`)}return r};function Ct(a){a.source_=wt(a.source_.map(l=>{const{reps:r}=l.options_||{};return r?(delete l.options_.reps,Array(r).fill(l)):[l]}))}function b(a,l){switch(a.type_){case"pattern":{Ct(a);const r=a.source_.map(d=>b(d,l)).map(At(a,l)),h=a.arguments_.alignment;if(h==="stack")return ke(...r);if(h==="polymeter"){const d=a.arguments_.stepsPerCycle?b(a.arguments_.stepsPerCycle,l).fmap(y=>De(y)):Re(De(r.length>0?r[0].__weight:1)),_=r.map(y=>y.fast(d.fmap(v=>v.div(y.__weight||1))));return ke(..._)}if(h==="rand")return mt(...r);const m=a.source_.some(d=>!!d.options_?.weight);if(!m&&h==="slowcat")return _t(...r);if(m){const d=a.source_.reduce((y,v)=>y+(v.options_?.weight||1),0),_=dt(...a.source_.map((y,v)=>[y.options_?.weight||1,r[v]]));return h==="slowcat"?_._slow(d):(_.__weight=d,_)}const A=Oe(...r);return A.__weight=r.length,A}case"element":return b(a.source_,l);case"atom":{if(a.source_==="~")return Se;if(!a.location_)return console.warn("no location for",a),a.source_;const{start:r,end:h}=a.location_,m=isNaN(Number(a.source_))?a.source_:Number(a.source_),A=l?.split("").slice(r.offset,h.offset).join(""),[d=0,_=0]=A?A.split(a.source_).map(y=>y.split("").filter(v=>v===" ").length):[];return Re(m).withLocation([r.line,r.column+d,r.offset+d],[r.line,h.column-_,h.offset-_])}case"stretch":return b(a.source_,l).slow(b(a.arguments_.amount,l));default:return console.warn(`node type "${a.type_}" not implemented -> returning silence`),Se}}const bt=(...a)=>{const l=a.map(r=>{const h=`"${r}"`,m=qe(h);return b(m,h)});return Oe(...l)},Ft=a=>{const l=qe(a);return b(l,a)};function jt(a){return typeof a=="string"?bt(a):K(a)}export{I as SyntaxError,Ft as h,bt as mini,jt as minify,qe as parse,b as patternifyAST};
